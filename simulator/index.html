<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seshat Fabric Simulator</title>
  <link rel="stylesheet" href="/src/styles.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header id="header">
      <h1>Seshat Fabric</h1>
      <nav id="module-tabs">
        <button class="tab active" data-module="designer">T-Piece Designer</button>
        <button class="tab" data-module="assembly">Assembly Sandbox</button>
        <button class="tab" data-module="magnetic">Magnetic Model</button>
        <button class="tab" data-module="power">Power Calculator</button>
        <button class="tab" data-module="catalog">Behavioral Catalog</button>
      </nav>
    </header>

    <!-- Main content area -->
    <main id="main">
      <!-- 3D viewport -->
      <div id="viewport"></div>

      <!-- Side panel -->
      <aside id="panel">
        <!-- T-Piece Designer controls -->
        <div id="designer-panel" class="panel-content active">
          <h2>T-Piece Parameters</h2>

          <div class="param-group">
            <h3>Presets</h3>
            <div class="preset-buttons">
              <button class="preset-btn" data-preset="proof">Proof of Concept (50mm)</button>
              <button class="preset-btn" data-preset="tabletop">Tabletop Demo (25mm)</button>
              <button class="preset-btn" data-preset="wearable">Wearable Scale (12mm)</button>
              <button class="preset-btn" data-preset="arm">Arm Cover (6mm)</button>
            </div>
          </div>

          <div class="param-group">
            <h3>Crossbar</h3>
            <label>
              Length <span class="value" id="val-cb-length">25</span> mm
              <input type="range" id="cb-length" min="4" max="100" value="25" step="1">
            </label>
            <label>
              Width <span class="value" id="val-cb-width">3</span> mm
              <input type="range" id="cb-width" min="1" max="10" value="3" step="0.5">
            </label>
            <label>
              Thickness <span class="value" id="val-cb-thickness">2</span> mm
              <input type="range" id="cb-thickness" min="0.5" max="5" value="2" step="0.5">
            </label>
          </div>

          <div class="param-group">
            <h3>Stem</h3>
            <label>
              Min Length <span class="value" id="val-st-min">5</span> mm
              <input type="range" id="st-min" min="2" max="40" value="5" step="1">
            </label>
            <label>
              Max Length <span class="value" id="val-st-max">22</span> mm
              <input type="range" id="st-max" min="4" max="60" value="22" step="1">
            </label>
            <label>
              Width <span class="value" id="val-st-width">2.5</span> mm
              <input type="range" id="st-width" min="1" max="8" value="2.5" step="0.5">
            </label>
          </div>

          <div class="param-group">
            <h3>Magnets</h3>
            <label>
              Diameter <span class="value" id="val-mag-dia">3</span> mm
              <input type="range" id="mag-dia" min="1" max="10" value="3" step="0.5">
            </label>
            <label>
              Depth <span class="value" id="val-mag-depth">1.5</span> mm
              <input type="range" id="mag-depth" min="0.5" max="5" value="1.5" step="0.5">
            </label>
          </div>

          <div class="param-group">
            <h3>Display</h3>
            <label class="checkbox-label">
              <input type="checkbox" id="show-wireframe"> Wireframe overlay
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="show-magnets" checked> Show magnet recesses
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="show-dimensions"> Show dimensions
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="show-polygon" checked> Show polygon preview
            </label>
            <select id="polygon-type">
              <option value="triangle">Triangle (3 pieces)</option>
              <option value="hexagon" selected>Hexagon (6 pieces)</option>
              <option value="square">Square (4 pieces)</option>
            </select>
          </div>

          <div class="param-group">
            <h3>Export</h3>
            <button id="export-stl" class="action-btn">Export STL</button>
            <button id="export-params" class="action-btn secondary">Export Parameters (JSON)</button>
          </div>

          <div class="param-group">
            <h3>Info</h3>
            <div id="info-panel">
              <div class="info-row"><span>Volume:</span><span id="info-volume">-</span></div>
              <div class="info-row"><span>Weight (PETG):</span><span id="info-weight">-</span></div>
              <div class="info-row"><span>Stem range:</span><span id="info-stem-range">-</span></div>
              <div class="info-row"><span>Hex inscribed r:</span><span id="info-hex-radius">-</span></div>
              <div class="info-row"><span>Stem reaches:</span><span id="info-stem-reaches">-</span></div>
            </div>
          </div>
        </div>

        <!-- Assembly Sandbox controls -->
        <div id="assembly-panel" class="panel-content">
          <h2>Assembly Sandbox</h2>

          <div class="param-group">
            <h3>Controls</h3>
            <p class="help-text">Left-click: place polygon</p>
            <p class="help-text">Right-click: select cell</p>
            <p class="help-text">Shift+click: simulate impact</p>
          </div>

          <div class="param-group">
            <h3>Placement</h3>
            <select id="placement-type">
              <option value="triangle">Triangle (3 pieces)</option>
              <option value="hexagon" selected>Hexagon (6 pieces)</option>
              <option value="square">Square (4 pieces)</option>
            </select>
          </div>

          <div class="param-group">
            <h3>Display</h3>
            <label class="checkbox-label">
              <input type="checkbox" id="show-edges" checked> Show ε graph
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="show-modes" checked> Color by σ mode
            </label>
          </div>

          <div class="param-group">
            <h3>Impact Simulation</h3>
            <label>
              Force <span class="value" id="val-impact-force">5</span> N
              <input type="range" id="impact-force" min="0.5" max="50" value="5" step="0.5">
            </label>
            <button id="clear-impact" class="action-btn secondary">Clear Impact</button>
          </div>

          <div class="param-group">
            <h3>Actions</h3>
            <button id="cycle-mode" class="action-btn secondary">Cycle Selected Mode</button>
            <button id="reset-assembly" class="action-btn secondary">Reset Assembly</button>
          </div>

          <div class="param-group">
            <h3>Structure Stats</h3>
            <div id="assembly-stats" class="info-panel-inner">
              <p class="placeholder">Place polygons to begin</p>
            </div>
          </div>

          <div class="param-group">
            <h3>Selected Cell</h3>
            <div id="cell-info" class="info-panel-inner">
              <p class="placeholder">Right-click a cell to inspect</p>
            </div>
          </div>

          <div class="param-group">
            <h3>Impact Results</h3>
            <div id="impact-info" class="info-panel-inner">
              <p class="placeholder">Shift+click to simulate impact</p>
            </div>
          </div>

          <div class="param-group">
            <h3>Mode Legend</h3>
            <div id="mode-legend" class="mode-legend">
              <div class="legend-item"><span class="legend-swatch" style="background:#4488cc"></span>rigid</div>
              <div class="legend-item"><span class="legend-swatch" style="background:#66aadd"></span>flex</div>
              <div class="legend-item"><span class="legend-swatch" style="background:#44cc88"></span>relay-recv</div>
              <div class="legend-item"><span class="legend-swatch" style="background:#88cc44"></span>relay-pass</div>
              <div class="legend-item"><span class="legend-swatch" style="background:#cccc44"></span>attract</div>
              <div class="legend-item"><span class="legend-swatch" style="background:#cc8844"></span>release</div>
              <div class="legend-item"><span class="legend-swatch" style="background:#cc4444"></span>transit</div>
              <div class="legend-item"><span class="legend-swatch" style="background:#44cccc"></span>harvest</div>
              <div class="legend-item"><span class="legend-swatch" style="background:#aa44cc"></span>sense</div>
              <div class="legend-item"><span class="legend-swatch" style="background:#555566"></span>idle</div>
            </div>
          </div>
        </div>

        <!-- Magnetic Model controls -->
        <div id="magnetic-panel" class="panel-content">
          <h2>Magnetic Model</h2>

          <div class="param-group">
            <h3>Magnet Configuration</h3>
            <label>
              Grade
              <select id="mag-grade">
                <option value="N35">N35 (1.19T)</option>
                <option value="N42" selected>N42 (1.30T)</option>
                <option value="N52">N52 (1.45T)</option>
              </select>
            </label>
            <label>
              Diameter <span class="value" id="val-mag-model-dia">3</span> mm
              <input type="range" id="mag-model-dia" min="1" max="10" value="3" step="0.5">
            </label>
            <label>
              Height <span class="value" id="val-mag-height">1.5</span> mm
              <input type="range" id="mag-height" min="0.5" max="5" value="1.5" step="0.5">
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="mag-compare" checked> Compare all grades
            </label>
          </div>

          <div class="param-group">
            <h3>Force Curve</h3>
            <canvas id="force-chart" width="280" height="220"></canvas>
          </div>

          <div class="param-group">
            <h3>Key Metrics</h3>
            <div id="magnet-metrics" class="info-panel-inner">
              <p class="placeholder">Adjust parameters above</p>
            </div>
          </div>
        </div>

        <!-- Power Calculator controls -->
        <div id="power-panel" class="panel-content">
          <h2>Power Calculator</h2>

          <div class="param-group">
            <h3>Cell Configuration</h3>
            <label>
              Cell size <span class="value" id="val-power-cell">25</span> mm
              <input type="range" id="power-cell-size" min="4" max="100" value="25" step="1">
            </label>
            <label>
              Processor
              <select id="power-processor">
                <option value="attiny85">ATtiny85 (ultra-low power)</option>
                <option value="rp2040">RP2040 (low power)</option>
                <option value="esp32c3" selected>ESP32-C3 (BLE capable)</option>
              </select>
            </label>
            <label>
              Magnet grade
              <select id="power-magnet">
                <option value="N35">N35</option>
                <option value="N42" selected>N42</option>
                <option value="N52">N52</option>
              </select>
            </label>
            <label>
              Magnet size <span class="value" id="val-power-mag-size">3</span> mm
              <input type="range" id="power-mag-size" min="1" max="10" value="3" step="0.5">
            </label>
          </div>

          <div class="param-group">
            <h3>Environment</h3>
            <select id="power-environment">
              <option value="indoor_dim">Indoor dim (100 lux)</option>
              <option value="indoor_bright">Indoor bright (500 lux)</option>
              <option value="outdoor_cloudy">Outdoor cloudy (10k lux)</option>
              <option value="outdoor_sunny" selected>Outdoor sunny (50k lux)</option>
            </select>
            <label>
              Switch type
              <select id="power-switch">
                <option value="sma" selected>SMA wire (strong, slow)</option>
                <option value="coil">Electromagnet (weak, fast)</option>
              </select>
            </label>
          </div>

          <div class="param-group">
            <h3>Results</h3>
            <div id="power-results" class="info-panel-inner">
              <p class="placeholder">Configure cell above</p>
            </div>
          </div>
        </div>

        <!-- Behavioral Catalog controls (placeholder) -->
        <div id="catalog-panel" class="panel-content">
          <h2>Behavioral Catalog</h2>
          <p class="placeholder">Coming in Phase 1</p>
        </div>
      </aside>
    </main>

    <!-- Status bar -->
    <footer id="status-bar">
      <span id="status-text">Ready</span>
      <span id="status-fps"></span>
    </footer>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
